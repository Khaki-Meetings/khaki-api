databaseChangeLog:
  - changeSet:
      id: init-views-1
      author: jacob (generated)
      changes:
        - createView:
            viewName: v_participant_count_per_meeting
            remarks: A String
            replaceIfExists: false
            selectQuery: >-
                select
                  count(calendarEventParticipant.email_id) totalParticipantsPerMeeting,
                  calendarEventParticipant.calendar_event_id calendarEventId
                from calendar_event_participant_dao calendarEventParticipant
                group by calendarEventParticipant.calendar_event_id
  - changeSet:
      id: init-views-2
      author: jacob (generated)
      changes:
        - createView:
            viewName: v_total_meeting_hours
            remarks: A String
            replaceIfExists: false
            selectQuery: >-
                select timestampdiff(hour, organizerCalendarEvent.end, organizerCalendarEvent.start) totalEventHours,
                       organizerCalendarEvent.id                                                     organizerCalendarEventId,
                       organizerCalendarEventParticipant.email_id                                    organizerEmailId
                from calendar_event_participant_dao organizerCalendarEventParticipant
                         inner join calendar_event_dao organizerCalendarEvent
                                    on organizerCalendarEvent.id = organizerCalendarEventParticipant.calendar_event_id
                where organizerCalendarEventParticipant.organizer = true
  - changeSet:
      id: init-views-3
      author: jacob (generated)
      changes:
        - createView:
            viewName: v_total_meeting_hours_of_all_participants
            remarks: A String
            replaceIfExists: false
            selectQuery: >-
                select (v_total_meeting_hours.totalEventHours * v_participant_count_per_meeting.totalParticipantsPerMeeting) totalHours,
                       v_participant_count_per_meeting.calendarEventId
                from v_participant_count_per_meeting
                         left join v_total_meeting_hours
                                   on v_total_meeting_hours.organizerCalendarEventId = v_participant_count_per_meeting.calendarEventId
  - changeSet:
      id: init-views-4
      author: jacob (generated)
      changes:
        - createView:
            viewName: v_total_meeting_hours_per_organizer
            remarks: A String
            replaceIfExists: false
            selectQuery: >-
                select cast(sum(totalHours) as INTEGER) totalMeetingHours, calEventPar.email_id organizerEmailId
                from v_total_meeting_hours_of_all_participants
                         left join calendar_event_participant_dao calEventPar
                                   on calEventPar.calendar_event_id = v_total_meeting_hours_of_all_participants.calendarEventId and
                                      calEventPar.organizer = true
                group by calEventPar.email_id
  - changeSet:
      id: init-views-5
      author: jacob (generated)
      changes:
        - createView:
            viewName: v_total_meetings_per_organizer
            remarks: A String
            replaceIfExists: false
            selectQuery: >-
                select count(organizerCalendarEventParticipant.calendar_event_id) totalMeetings,
                       organizerCalendarEventParticipant.email_id                 organizerEmailId
                from calendar_event_participant_dao organizerCalendarEventParticipant
                where organizerCalendarEventParticipant.organizer = true
                group by organizerCalendarEventParticipant.email_id
  - changeSet:
      id: init-views-6
      author: jacob (generated)
      changes:
        - createView:
            viewName: v_total_hourly_meeting_cost_per_organizer
            remarks: A String
            replaceIfExists: false
            selectQuery: >-
                select organizerEmail.id                         organizerEmailId,
                       sum(participantSalaryGroup.salary) / 2000 totalMeetingHourlyCost
                from calendar_event_participant_dao calEventParticipantOrganizer
                         left join email_dao organizerEmail on calEventParticipantOrganizer.email_id = organizerEmail.id
                         right join calendar_event_participant_dao calEventParticipantParticipant
                                    on calEventParticipantParticipant.calendar_event_id = calEventParticipantOrganizer.calendar_event_id
                         left join email_dao participantEmail on calEventParticipantParticipant.email_id = participantEmail.id
                         left join email_dao_people participantEmailPerson on participantEmailPerson.emails_id = participantEmail.id
                         left join person_dao participantPerson on participantPerson.id = participantEmailPerson.people_id
                         left join employee_dao employee on employee.person_id = participantPerson.id
                         left join salary_group_dao participantSalaryGroup on participantSalaryGroup.id = employee.salary_group_id
                where calEventParticipantOrganizer.organizer = true
                group by organizerEmail.id
  - changeSet:
        id: init-views-7
        author: jacob (generated)
        changes:
            - createView:
                  viewName: v_organizer_statistics
                  remarks: A String
                  replaceIfExists: false
                  selectQuery: >-
                      select uuid() id,
                             totalMeetingHours total_meeting_hours,
                             totalMeetingHourlyCost total_meeting_hourly_cost,
                             totalMeetings total_meetings,
                             (totalMeetingHours * totalMeetingHourlyCost) as total_cost,
                             v_total_meeting_hours_per_organizer.organizerEmailId organizer_email_id,
                             concat(email.user, '@', domain.name) organizer_email,
                             organizerOrganization.id                        organization_id
                      from v_total_meeting_hours_per_organizer
                               left join v_total_hourly_meeting_cost_per_organizer
                                         on v_total_hourly_meeting_cost_per_organizer.organizerEmailId =
                                            v_total_meeting_hours_per_organizer.organizerEmailId
                               left join v_total_meetings_per_organizer
                                         on v_total_meetings_per_organizer.organizerEmailId =
                                            v_total_meeting_hours_per_organizer.organizerEmailId
                               left join email_dao email on email.id = v_total_meeting_hours_per_organizer.organizerEmailId
                               left join domain_dao domain on domain.id = email.domain_id
                               left join email_dao_people organizerEmailPerson
                                         on organizerEmailPerson.emails_id = v_total_meeting_hours_per_organizer.organizerEmailId
                               left join person_dao organizerPerson on organizerPerson.id = organizerEmailPerson.people_id
                               left join employee_dao organizerEmployee on organizerEmployee.person_id = organizerPerson.id
                               left join department_dao organizerDepartment on organizerDepartment.id = organizerEmployee.department_id
                               left join organization_dao organizerOrganization
                                         on organizerOrganization.id = organizerDepartment.organization_id
